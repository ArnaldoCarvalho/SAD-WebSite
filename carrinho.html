<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho de Compras</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .car-image {
      width: 120px;
      height: 80px;
      object-fit: cover;
      border-radius: 6px;
    }
  </style>
</head>
<body>
    <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Admin Panel</a>
      <button class="btn btn-danger ms-auto" onclick="logout()">Logout</button>
    </div>
  </nav>
  
  <div class="container py-5">
    <h2 class="mb-4">Carrinho de Compras</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Imagem</th>
          <th>Carro</th>
          <th>Preço</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody id="cartItems">
      </tbody>
    </table>
    <p class="fw-bold" id="totalPrice">Total: €0</p>
    <button id="checkoutBtn" class="btn btn-primary">Comprar</button>
    <a href="index.html#carros" class="btn btn-outline-secondary mt-2">Continuar a comprar</a>
  </div>

  <script>
    // Protege a página
    if(localStorage.getItem('loggedIn') !== 'true') {
      window.location.href = 'login.html';
    }

    const cartItemsEl = document.getElementById('cartItems');
    const totalPriceEl = document.getElementById('totalPrice');
    const checkoutBtn = document.getElementById('checkoutBtn');

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function updateCart() {
      cartItemsEl.innerHTML = '';
      let total = 0;
      cart.forEach((car, index) => {
        const priceNumber = parseFloat(car.price.replace('€','').replace(',','').replace('.','')) || 0;
        total += priceNumber;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${car.image}" class="car-image"></td>
          <td>${car.title}</td>
          <td>${car.price}</td>
          <td><button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})">Remover</button></td>
        `;
        cartItemsEl.appendChild(tr);
      });
      totalPriceEl.textContent = 'Total: €' + total.toLocaleString('pt-PT');
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    checkoutBtn.addEventListener('click', () => {
      if(cart.length === 0) {
        alert("O carrinho está vazio!");
        return;
      }
      alert("Veiculo comprado com sucesso!\nObrigado pela sua preferência.");
      localStorage.removeItem('cart');
      updateCart();
    });

    updateCart();
  </script>
</body>
</html>
